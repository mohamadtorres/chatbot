<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Prism.js for Syntax Highlighting -->
<!-- Markdown-it (For Markdown Parsing) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.3.2/markdown-it.min.js"></script>

<!-- Highlight.js (For Code Syntax Highlighting) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>

<!-- KaTeX (For Math Rendering) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.3/contrib/auto-render.min.js"></script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwecoDeep</title>
    <!-- <script type="text/javascript" id="MathJax-script" async 
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script> -->
    
    <link rel="stylesheet" href="static\styles\style.css">

</head>
<body>
    {% load static %}
    <div class="header">
        <img src="{% static 'images/sweco_logo1.png' %}" alt="Sweco Logo">
        <h1>SwecoDeep</h1>
    </div>

    <div class="container">
        
        <div class="sidebar">
            <h3>Menu</h3>
            <a href="#">Home</a>
            <a href="#">Recent chats</a>
            <div class=bottom-links">
            <!-- Privacy Button -->
                <a href="#" onclick="openModal('privacyModal')">
                    Privacy <span class="info-icon">ⓘ</span>
                </a>
            
                <!-- Help Button -->
                <a href="#" onclick="openModal('helpModal')">
                    Help <span class="info-icon">ⓘ</span>
                </a>
                </div>
        </div>
        
        <!-- Privacy Modal -->
        <div id="privacyModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('privacyModal')">&times;</span>
                <h2>Privacy Policy</h2>
                <h3>1. Introduction:</h3>
                    <p>At Sweco, we take your privacy seriously. This Privacy Notice explains how we collect, use, and protect your personal information when you interact with SwecoGPT, our AI assistant. We are committed to ensuring that your personal information is protected and handled in accordance with applicable data protection laws.</p>
                    
                    <h3>2. Information We Collect:</h3>
                    <p>SwecoGPT may collect and process personal information provided by you during the course of your interaction with SwecoGPT. This may include your name, contact details, and any other information you choose to share.</p>
                    
                    <h3>3. Use of Personal Information:</h3>
                    
                    <li>To provide you with accurate and relevant responses to your queries or requests.<br></li>
                    <li>To improve our AI assistant's functionality and performance.<br>
                    <li>To conduct data analysis and research to enhance our services.<br></li>
                    <li>To comply with legal obligations and respond to lawful requests.<br></li>
                    <li>To increase usage of AI at Sweco</li><br>
                    <h3>4. Data Sharing and Disclosure:</h3>
                    <p>We do not share or disclose your personal information collected by SwecoGPT to third parties unless required by law or with your explicit consent.</p>
                    
                    <h3>5. Data Security:</h3>
                    <p>We have implemented appropriate technical and organizational measures to safeguard your personal information against unauthorized access, loss, or alteration. However, please note that no method of transmission over the internet or electronic storage is 100% secure.</p>
                    
                    <h3>6. Retention of Personal Information:</h3>
                    <p>We will retain your personal information collected by SwecoGPT only for as long as necessary to fulfill the purposes outlined in this Privacy Notice, unless a longer retention period is required or permitted by law.</p>
                    
                    <h3>7. Your Rights:</h3>
                    <p>You have certain rights regarding your personal information, including the right to access, correct, or delete your personal information. If you have any questions or wish to exercise your rights, please contact us using the contact information provided below.</p>
                    
                    <h3>8. Changes to this Privacy Notice:</h3>
                    <p>We may update this Privacy Notice from time to time to reflect changes in our practices or legal requirements. We encourage you to review this Privacy Notice periodically.</p>
                    <h3>Contact Us:
                    <p>If you have any questions, concerns, or requests regarding this Privacy Notice or the processing of your personal information by SwecoGPT, please contact your Local Privacy Officer</p>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('helpModal')">&times;</span>
                <h2>Help</h2>
                <b>SwecoGPT</b> is an advanced AI capable of understanding and generating human-like text. Use it for tasks such as drafting emails, creating content, and answering questions. Please use this service in an ethical way. Do not share confidential information from Sweco, clients or other parties without consent from the information owner. Respect the privacy of others in accordance with Sweco's privacy policies and procedures. It is for example not allowed to use the service to process sensitive client data, HR data or other sensitive data about employees. It's proficient in many topics, but its knowledge is based on information available up until April 2023. Limitations include inability to access real-time data, understand new events post-training, and provide personal advice. SwecoGPT may occasionally generate incorrect or outdated information. It learns from a broad array of sources, some of which may contain inaccuracies. It can't validate or fact-check information in real-time. Always cross-verify critical information from trusted sources and apply your judgment when using AI-generated content.<br>

                For guidance information regarding AI usage at Sweco refer to the AI Usage Procedure.<br>
                
                <h3>SwecoGPT Document Storage Instructions</h3>
                1. Users can upload a maximum of 100 MB per folder.<br>
                
                2. Each user can have 5 folders.<br>

                3. Only copies of documents should be uploaded. Users should always keep an original version on a separate storage.<br>
                
                4. Documents should only be uploaded for the intended purpose of SwecoGPT. The intended purpose is to use GPT prompts regularly on the document contents.<br>
                
                5. If a folder has not been activated for 45 days, an email will be sent to the user that the folder and contents will be deleted in 30 days, a reminder email will be sent after 10 more days if it is not activated or deleted, a reminder email will be sent after 10 further days if it is not activated or deleted, a final reminder email will be sent 7 days after with final warning of deletion in 3 days time.
                
                6. The folder will be unindexed and then native files archived for 30 further days and then deleted, after this the documents will be unrecoverable.<br>
                
                7. The policy is the same for shared folders.
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-box" id="chatbox">
                <!-- Chat messages will appear here... -->
            </div>
            <div class="input-area">
                <textarea id="userInput" placeholder="Type a message..." onkeydown="handleKeyPress(event)"></textarea>
                <button onclick="sendMessage()" id="sendButton">
                    &#9658; <!-- Unicode for a small right arrow -->
                </button>
            </div>
        </div>
        <script>
            function sendMessage() {
                let userInput = document.getElementById("userInput").value;
                let chatbox = document.getElementById("chatbox");

                if (userInput.trim() === "") return; // Prevent empty messages

                // ✅ Display the user message correctly
                chatbox.innerHTML += `<div class="user-message">${userInput}</div>`;
                document.getElementById("userInput").value = "";
                chatbox.scrollTop = chatbox.scrollHeight;

                // ✅ Send request to chatbot API
                fetch("/chatbot/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userInput })
                })
                .then(response => response.json())
                .then(data => {
                    if ("reply" in data) {
                        let botMessage = formatresponse(data.reply);
                        let thoughtProcess = data.thought || "";

                        let thoughtHtml = thoughtProcess ? `
                            <div class="thought-container">
                                <button class="toggle-thought" onclick="toggleThought(this)" title="Show Thought Process">
                                    &#9660; <!-- Unicode for down arrow ⬇ -->
                                </button>
                                <div class="thought-content" style="display: none;">
                                    <p><strong>Chatbot Thought Process:</strong></p>
                                    <p>${thoughtProcess}</p>
                                </div>
                            </div>
                        ` : "";

                        // ✅ Ensure the thought process appears BEFORE the bot's reply
                        chatbox.innerHTML += thoughtHtml + `<div class="bot-message">🤖: ${botMessage}</div>`;

                        // ✅ Ensure Markdown, Syntax Highlighting & KaTeX Work
                        setTimeout(() => {
                            document.querySelectorAll('pre code').forEach((block) => {
                                hljs.highlightElement(block);
                            });

                            // ✅ Apply KaTeX after inserting the message
                            renderMathInElement(chatbox, {
                                delimiters: [
                                    { left: "$$", right: "$$", display: true },  // Block math
                                    { left: "$", right: "$", display: false },  // Inline math
                                    { left: "\\(", right: "\\)", display: false },  // Ensure inline math
                                    { left: "\\[", right: "\\]", display: true }   // Ensure block math
                                ]
                            });
                        }, 50);
                    } else {
                        chatbox.innerHTML += `<p class="bot-message">ChatBot: Error: No response received.</p>`;
                    }

                    chatbox.scrollTop = chatbox.scrollHeight; // ✅ Auto-scroll to latest message
                })

                .catch(error => {
                    console.error("Error:", error);
                    chatbox.innerHTML += `<p class="bot-message">Error: Unable to contact chatbot.</p>`;
                });
            }



        
            function toggleThought(button) {
                let content = button.nextElementSibling;
                
                if (content.style.display === "none") {
                    content.style.display = "block"; // Show thought process
                    button.innerHTML = "&#9650;"; // Change arrow to up (⬆)
                    button.title = "Hide Thought Process"; // Change tooltip
                } else {
                    content.style.display = "none"; // Hide thought process
                    button.innerHTML = "&#9660;"; // Change arrow back to down (⬇)
                    button.title = "Show Thought Process"; // Reset tooltip
                }
            }

            function handleKeyPress(event) {
                if (event.key === "Enter" && !event.shiftKey) {
                    event.preventDefault();
                    sendMessage();
                }
            }
            // function formatresponse(response) {
            //     if (!response) return "";

            //     // Convert `\n` to `<br>` for paragraph separation (but not inside code blocks)
            //     response = response.replace(/\n/g, "<br>");

            //     // Convert **bold text** to `<strong>bold text</strong>`
            //     response = response.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

            //     // Convert __italic text__ to `<em>italic text</em>`
            //     response = response.replace(/__(.*?)__/g, "<em>$1</em>");

            //     // Convert `- lists` into `<ul><li>` format
            //     response = response.replace(/- (.*?)(<br>|$)/g, "<li>$1</li>");
            //     response = response.replace(/(<li>.*<\/li>)+/g, "<ul>$&</ul>"); // Wrap lists in <ul>

            //     // Convert links (URLs) into clickable `<a>` elements
            //     response = response.replace(/(https?:\/\/[^\s]+)/g, "<a href='$1' target='_blank'>$1</a>");

            //     // ✅ Convert inline code (`code`) into `<code>code</code>`
            //     response = response.replace(/`([^`]+?)`/g, "<code>$1</code>");

            //     // ✅ Fix multi-line code blocks correctly
            //     response = response.replace(/```(\w*)\n([\s\S]+?)```/g, function(match, lang, code) {
            //         let languageClass = lang ? `language-${lang}` : "language-python"; // Default to Python if no language is specified

            //         return `
            //             <div class="code-container">
            //                 <div class="code-header">
            //                     <span class="language-label">${languageClass}</span>
            //                     <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            //                 </div>
            //                 <pre><code class="${languageClass}">${Prism.highlight(code.trim(), Prism.languages[lang] || Prism.languages.python, lang || 'python')}</code></pre>
            //             </div>
            //         `;
            //     });

            //     return response;
            // }
            function formatresponse(response) {
                if (!response) return "";

                const md = window.markdownit(); // ✅ Initialize Markdown-it
                let formattedResponse = md.render(response); // ✅ Convert Markdown to HTML

                // ✅ Convert old MathJax format to KaTeX-compatible format
                formattedResponse = formattedResponse
                    .replace(/\[([^\]]+)\]/g, "\\($1\\)")  // Inline Math: `[ ... ]` → `\( ... \)`
                    .replace(/\\\[(.*?)\\\]/g, "\\[$1\\]") // Block Math: `\[ ... \]` stays unchanged
                    .replace(/\$\$(.*?)\$\$/gs, "<span class='math-block'>$$$1$$</span>")  // Block Math: `$$ ... $$`
                    .replace(/\$(.*?)\$/g, "<span class='math-inline'>$1</span>");  // Inline Math: `$ ... $`

                return formattedResponse; // ✅ Return fully formatted response
            }





            // ✅ Function to copy code from the box
            function copyCode(button) {
                let codeBlock = button.parentElement.nextElementSibling.querySelector("code");
                let textArea = document.createElement("textarea");
                textArea.value = codeBlock.innerText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                button.innerText = "Copied!";
                setTimeout(() => button.innerText = "Copy", 2000);
            }



            // Function to open the modal when the user clicks
            function openModal(modalId) {
                let modal = document.getElementById(modalId);
                modal.style.display = "flex"; // ✅ Fix: Ensures proper alignment in the center
            }

            // Function to close the modal when clicking "X"
            function closeModal(modalId) {
                let modal = document.getElementById(modalId);
                modal.style.display = "none";
            }

            // ✅ Close modal when clicking outside of it
            window.onclick = function(event) {
                let modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
            modal.style.display = "none";
                    }
                });
            };






        </script>
        
        
        

    </div>

    <div class="footer">
        &copy; 2025 Designed by Sweco based on a <span style="color: #4d6bfe;">DeepSeek</span> model <!--To have the deepseek word in blue like the real deepseek-->
        <h5>Sweek may produce inaccurate information about people, places, or facts. Please check before using the information.</h5>
    </div>

</body>
</html>
